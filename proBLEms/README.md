# Indoor Positioning System (proBLEms)

## Описание
Приложение состоит из трёх сервисов:
- **MQTT брокер** (Eclipse Mosquitto) – для обмена данными между устройствами.
- **Backend** (FastAPI, Python) – обрабатывает данные от маяков и клиентов.
- **Frontend** (Vite + Node.js) – веб-интерфейс для отображения данных.

Все сервисы запускаются через **Docker Compose**.

---

## Требования
- [Docker](https://docs.docker.com/get-docker/)
- [Docker Compose](https://docs.docker.com/compose/install/)

---

## Быстрая конфигурация системы

Для обновления расположения маячков необходимо заменить файл с конфигурацией:

1. Подготовить новый файл с координатами маячков.  
   ⚠️ Файл должен называться **standart.beacons**.

2. Положите файл в папку:
```bash
backend/data/maps/
```

3. Перезапустить контейнеры, чтобы изменения вступили в силу:
```bash
docker compose down
docker compose up --build -d
```

## Конфигурация платы
Для загрузки программы используется **Thonny IDE**. 
1. Нажать Tools > Options > Interpreter > "MicroPythonESP32" > OK.
2. Нажать кнопку "STOP", чтобы плата подключилась.
3. File > Open > открыть файлы main.py и networking.py.
4. File > Save As > MicroPython Device > указать соответствующий File Name > OK. 
5. В файле networking.py установить "WIFI_SSID" и "WIFI_PASSWORD". Сохранить через п.4.

* Любое сохранение файлов по п. 4.
* Для запуска нажать F5 или зеленую кнопку Run.
* При возникновении проблем с платой (напр., Device is busy), нажать STOP. Далее, можно заново начинать работу или сохранять файлы.

---

## Запуск

1. Клонируйте репозиторий и перейдите в папку проекта:

```bash
git clone https://github.com/hackyadro-proBLEms/proBLEms.git
cd proBLEms
```

2. Запустите сервисы:
```bash
docker compose up --build
```

3. После успешного запуска будут доступны сервисы:
```bash
MQTT брокер: mqtt://localhost:1883

Backend API: http://localhost:8000
(доступна swagger-документация: http://localhost:8000/docs)

Frontend: http://localhost:8080
```

## Остановка
```bash
docker compose down
```

## Использование фронтенда
### Session Control
Блок управления сессией содержит:

1. Frequency (Hz) - частота регистрации сигнала. Для ввода используйте клавиатуру (дробные числа разделяйте запятой)
или используйте стрелки для увеличения/уменьшения значения.
Стартовое значение: 5 Гц.

2. Map ID - идентификатор карты (в данной версии не реализовано).

3. File Name - имя файла для сохранения данных (в данной версии не реализовано).

### Управление сессией
   - **Start Session** - запускает процесс регистрации сигналов и отображения текущего положения на карте.
   - **Stop Session** - останавливает сессию и автоматически сохраняет путь.

### Map View
На карте отображаются:
   - **Красные точки** - маячки с названиями в формате beacon_X, где X - номер маячка.
   - **Темно-серые линии и точки** - пройденный путь (точки положения и соединяющие их прямые).

### Session Status
Панель статуса сессии отображает:
   - **Status** - статус активности сессии:
      - No Session - сессия не активна;
      - started - сессия запущена;
      - stopped - сессия остановлена;
   - **Position** - текущие координаты устройства в формате "X: X, Y: Y";
   - **Points Recorded** - количество посчитанных устройством точек;
   - **Active beacons** - количество активных маячков в текущем месте;
