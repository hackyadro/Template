# Indoor Navigation Backend

Python –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è indoor-–Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ BLE/Beacon –º–∞—è–∫–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º RSSI –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìç **–ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ RSSI** - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–∏–ª—ã —Å–∏–≥–Ω–∞–ª–∞ –æ—Ç BLE –º–∞—è–∫–æ–≤
- üó∫Ô∏è **–¢—Ä–∏–ª–∞—Ç–µ—Ä–∞—Ü–∏—è** - —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ 3+ –º–∞—è–∫–æ–≤
- üìä **–•—Ä–∞–Ω–µ–Ω–∏–µ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–π** - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—É—Ç–∏ –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è
- üîå **REST API** - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∞—è–∫–∞–º–∏, –∏–∑–º–µ—Ä–µ–Ω–∏—è–º–∏ –∏ –ø–æ–∑–∏—Ü–∏—è–º–∏
- üê≥ **Docker** - –ª–µ–≥–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å PostgreSQL

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **FastAPI** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **PostgreSQL** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- **SQLAlchemy** - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- **NumPy** - –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –¥–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- **Docker & Docker Compose** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ —Å Docker

```bash
cd backend
docker-compose up --build
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8000`

PostgreSQL –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –ø–æ—Ä—Ç—É: `5432`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
curl http://localhost:8000/health
```

## API Endpoints

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

### –û—Å–Ω–æ–≤–Ω—ã–µ endpoints

#### –ú–∞—è–∫–∏ (Beacons)

- `GET /beacons` - –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–∞—è–∫–æ–≤
- `GET /beacons/{id}` - –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞—è–∫–µ
- `POST /beacons` - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –º–∞—è–∫
- `DELETE /beacons/{id}` - —É–¥–∞–ª–∏—Ç—å –º–∞—è–∫

**–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—è–∫–∞:**
```bash
curl -X POST http://localhost:8000/beacons \
  -H "Content-Type: application/json" \
  -d '{
    "name": "beacon_1",
    "x_coordinate": 3.0,
    "y_coordinate": -2.4,
    "description": "–ú–∞—è–∫ –≤ –∫–æ—Ä–∏–¥–æ—Ä–µ"
  }'
```

#### RSSI –ò–∑–º–µ—Ä–µ–Ω–∏—è

- `GET /measurements` - –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ—Ä–µ–Ω–∏–π
- `GET /measurements?beacon_id={id}` - –∏–∑–º–µ—Ä–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—è–∫–∞
- `POST /measurements` - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ

**–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–º–µ—Ä–µ–Ω–∏—è:**
```bash
curl -X POST http://localhost:8000/measurements \
  -H "Content-Type: application/json" \
  -d '{
    "beacon_id": 1,
    "rssi_value": -65
  }'
```

#### –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

- `POST /positions/calculate` - –≤—ã—á–∏—Å–ª–∏—Ç—å —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é
- `GET /positions` - –ø–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∑–∏—Ü–∏–π

**–ü—Ä–∏–º–µ—Ä –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏:**
```bash
curl -X POST http://localhost:8000/positions/calculate \
  -H "Content-Type: application/json" \
  -d '{
    "measurements": [
      {"beacon_id": 1, "rssi_value": -65},
      {"beacon_id": 2, "rssi_value": -72},
      {"beacon_id": 3, "rssi_value": -58}
    ],
    "save_trajectory": true
  }'
```

#### –¢—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏

- `GET /trajectories` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π
- `GET /trajectories/{session_id}` - –ø–æ–ª—É—á–∏—Ç—å —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Å–µ—Å—Å–∏–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py           # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ endpoints
‚îÇ   ‚îú‚îÄ‚îÄ models.py         # Pydantic –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ database.py       # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ positioning.py    # –ê–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îî‚îÄ‚îÄ 001_initial_schema.sql
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```

## –ê–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. RSSI ‚Üí Distance

–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å–∏–ª—ã —Å–∏–≥–Ω–∞–ª–∞ –≤ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ:
```
distance = 10 ^ ((RSSI_AT_1M - RSSI) / (10 * PATH_LOSS_EXPONENT))
```

### 2. –¢—Ä–∏–ª–∞—Ç–µ—Ä–∞—Ü–∏—è

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ –Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã —É—Ä–∞–≤–Ω–µ–Ω–∏–π –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ 3+ –º–∞—è–∫–æ–≤.

### 3. –í–∑–≤–µ—à–µ–Ω–Ω—ã–π —Ü–µ–Ω—Ç—Ä–æ–∏–¥

–ó–∞–ø–∞—Å–Ω–æ–π –º–µ—Ç–æ–¥ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ –º–∞—è–∫–æ–≤ - –≤—ã—á–∏—Å–ª—è–µ—Ç –ø–æ–∑–∏—Ü–∏—é –∫–∞–∫ –≤–∑–≤–µ—à–µ–Ω–Ω—ã–π —Ü–µ–Ω—Ç—Ä –º–∞—Å—Å.

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞

- **beacons** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ BLE –º–∞—è–∫–∞—Ö
- **rssi_measurements** - –∏–∑–º–µ—Ä–µ–Ω–∏—è —Å–∏–ª—ã —Å–∏–≥–Ω–∞–ª–∞
- **positions** - –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
- **trajectories** - —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL

```bash
docker exec -it indoor_navigation_db psql -U indoor_user -d indoor_navigation
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `DATABASE_URL` - URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `postgresql+asyncpg://indoor_user:indoor_pass@postgres:5432/indoor_navigation`)

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ª–æ–∫–∞–ª—å–Ω–æ

```bash
pip install -r requirements.txt
```

### –ó–∞–ø—É—Å–∫ –±–µ–∑ Docker

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL –æ—Ç–¥–µ–ª—å–Ω–æ
# –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
psql -U indoor_user -d indoor_navigation -f migrations/001_initial_schema.sql

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
uvicorn app.main:app --reload
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—è–∫–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Ñ–∞–π–ª `standart.beacons` —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –º–∞—è–∫–æ–≤:

```bash
# –ü—Ä–∏–º–µ—Ä —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—è–∫–æ–≤
while IFS=';' read -r name x y; do
  if [ "$name" != "Name" ]; then
    curl -X POST http://localhost:8000/beacons \
      -H "Content-Type: application/json" \
      -d "{\"name\": \"$name\", \"x_coordinate\": $x, \"y_coordinate\": $y}"
  fi
done < standart.beacons
```

## License

MIT
