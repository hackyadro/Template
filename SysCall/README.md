
Прошивка платы ESP32 с использованием MicroPython
-----
-----
Шаг 1: Подготовка
-----

Убедитесь, что у вас есть плата ESP32 и кабель для подключения к компьютеру.

Установите Python (рекомендуемая версия 3.x) и следуйте инструкциям на официальном сайте MicroPython
 для установки необходимого ПО.

Выполнить команду: python -m venv myenv. Здесь myenv — имя виртуального окружения (можно выбрать любое имя).
После создания окружения его нужно активировать:
```
Для Windows: myenv\Scripts\activate.

Для macOS и Linux: source myenv/bin/activate.
```
Шаг 2: Установка утилит для прошивки
-----
Для перепрошивки платы потребуется утилита esptool. Установите её с помощью pip:
```
pip install esptool
```
Шаг 3: Подключение платы ESP32
-----
Подключите плату ESP32 к вашему компьютеру через USB. Определите порт, к которому подключена плата (например, /dev/ttyUSB0 на Linux или COMx на Windows).

Шаг 4: Стирание старой прошивки 
-----
Если на плате уже установлена прошивка:
```
esptool.py --port /dev/ttyUSB0 erase_flash
```

Замените /dev/ttyUSB0 на правильный порт для вашей операционной системы и способа подключения.

Шаг 5: Прошивка платы ESP32
-----

Теперь можно загрузить MicroPython на вашу плату ESP32. Скачайте последнюю прошивку MicroPython с официального сайта
, а затем выполните команду:
```
esptool.py --port /dev/ttyUSB0 --baud 460800 write_flash 0x1000 esp32-xxxx.bin
```

Замените esp32-xxxx.bin на имя прошивки, которую вы скачали.

Шаг 6: Загрузка скрипта main.py
-----
Перед загрузкой main.py необходимо задать параметры соответствующие вашим данным Так же необходимо скачать библиотеку https://github.com/micropython/micropython-lib/blob/master/micropython/umqtt.simple/umqtt/simple.py. Перекинуть этот файл директорию lib сохранив название

Сеть необходима WPA3 - personal
~~~
WIFI_SSID = название сети
WIFI_PASSWORD = пароль сети
MQTT_BROKER = локальный ip адрес брокера (через ipconfig)
~~~

После успешной прошивки подключитесь к плате с помощью терминала или IDE, поддерживающей работу с MicroPython (PyCharm (самая новая версия) с плагином MicroPython)

Откройте терминал и подключитесь к плате ESP32 через интерфейс REPL или GUI плагина Micropython:
```
screen /dev/ttyUSB0 115200
```

Скопируйте файл main.py на плату ESP32. Это можно сделать через плагин в PyCharm или с помощью утилиты ampy. Например:
```
ampy --port /dev/ttyUSB0 put main.py
```

После этого файл main.py будет загружен в корень файловой системы платы ESP32.

Шаг 7: Перезагрузка платы
-----
После загрузки файла перезагрузите плату.

Теперь ваш скрипт main.py должен автоматически запуститься при старте платы.

---
Шаг 8: Запуск серверного файла app.py
---
Установить все нужные библиотеки при помощи requirements.txt
```
pip install -r requirements.txt
```

Шаг 9: Установка и настройка Mosquitto MQTT брокера
---
**Скачивание и установка Mosquitto**

Перейдите на официальную страницу Mosquitto
 и скачайте последнюю версию для вашей операционной системы (например, для Windows выберите mosquitto-<version>-installer.exe).

Запустите установщик и следуйте инструкциям на экране для завершения установки.

**Настройка конфигурации Mosquitto**

После установки необходимо настроить конфигурацию Mosquitto для корректной работы с платой ESP32 и сервером.

Перейдите в директорию, куда был установлен Mosquitto. На Windows это обычно будет что-то вроде:

~~~
C:\Program Files\mosquitto\
~~~

Откройте файл mosquitto.conf в текстовом редакторе, таком как Notepad или Notepad++.

Добавьте или отредактируйте следующие строки в начале файла:
```
listener 1883
allow_anonymous true
```
Сохраните изменения в файле

Шаг 10: Запуск Mosquitto
---
После того как конфигурация готова, можно запустить Mosquitto.

Перейдите в папку с установленным Mosquitto (где находится mosquitto.exe).

Откройте командную строку в этой папке или используйте команду cmd для открытия новой консоли.

Запустите Mosquitto с указанной конфигурацией с помощью следующей команды:

~~~
.\mosquitto.exe -c mosquitto.conf -v
~~~

Шаг 11: Запуск streamlit
---
В отдельной командной строке запустить 
```
streamlit run app.py
```

Шаг 12: Взаимодействие со сайтом
---
После запуска сайта и нажатия на кнопку "запись маршрута" необходимо дождаться появления красной точки на карте. Только тогда появится отрисовка и сохранение пути 

----
Требования к проведению испытания
---
Для корректной работы оборудывания необходимо держат плату не более 10 см от уровня земли антенной вниз.  